
<div class="grid">
    <div *ngIf="loading">
        <p-progressSpinner class="progress-spinner" styleClass="w-4rem h-4rem" strokeWidth="8"
            animationDuration=".5s"></p-progressSpinner>
    </div>
    <p-toast position="top-center" key="tc"></p-toast>
    <div class="col-12">
        <div class="card">

            <div class="font-bold text-3xl text-center">
                <span class="text-900">Administrar</span> <span class="text-blue-600"> Roles</span>
            </div>
            <hr>
            <p-table [value]="roles" [rows]="5" [tableStyle]="{'min-width': '20rem'}" [paginator]="true"
            [rowsPerPageOptions]="[5,10,20]"  [loading]="loading">
                <ng-template pTemplate="caption">
                    <div class="flex flex-column md:flex-row md:justify-content-between md:align-items-center">
                        <button pButton pRipple label="Adicionar rol" icon="pi pi-plus"
                            class="p-button-success mr-2" (click)="NuevoRol()">
                        </button>
                    </div>
                </ng-template>
                <ng-template pTemplate="header" let-columns>
                    <tr>
                        <th>C贸digo</th>
                        <th>Nombre</th>
                        <th>Descripci贸n</th>
                        <th>Registro por</th>
                        <th>Modificado por</th>
                        <!-- <th>Estado</th> -->
                        <th>Operaciones</th>
                    </tr>
                </ng-template>
                <ng-template pTemplate="body" let-rol>
                    <tr>
                        <td>{{rol.rolid}}</td>
                        <td>{{rol.rolnombre}}</td>
                        <td>{{rol.roldescripcion}}</td>
                        <td>
                            <p-chip>
                                <div class="p-2">
                                   {{ rol.rolusureg }} <br> {{ rol.rolfecreg }}
                                </div>
                             </p-chip>
                        <td>
                            <p-chip>
                                <div class="p-2">
                                   {{rol.rolusumod}} <br> {{ rol.rolfecmod }}
                                </div>
                            </p-chip>
                        </td>
                        <!-- <td>
                            <p-tag [value]="obtenerDescripcion(rol.rolestado)" [severity]="obtenerSeverity(rol.rolestado)" [rounded]="true"></p-tag>
                        </td> -->
                        <td>
                            <div class="flex justify-content-center">
                                <button pButton pRipple icon="pi pi-pencil" label="Editar" class="p-button-rounded p-button-info mr-2" (click)="modificarRol(rol)"></button>
                                <button pButton pRipple icon="pi pi-trash" class="p-button-rounded p-button-danger" label="Eliminar" (click)="eliminarRol(rol)"></button>
                            </div>
                        </td>
                    </tr>
                </ng-template>
            </p-table>
        </div>
    </div>

    <p-dialog [(visible)]="roldialog" [style]="{width: '450px'}" header="Registro rol" [modal]="true" class="p-fluid">
        <div *ngIf="loading">
            <p-progressSpinner class="progress-spinner" styleClass="w-4rem h-4rem" strokeWidth="8"
                animationDuration=".5s"></p-progressSpinner>
        </div>
        <ng-template pTemplate="content">
            <div class="field">
                <label for="name">Nombre</label>
                <input type="text"
                       pInputText
                       id="name"
                       (ngModelChange)="onNameChange($event)"
                       [(ngModel)]="rol.rolnombre"
                       required
                       [ngClass]="{'p-invalid': rol?.rolnombre?.trim() === null}"/>
                <small class="p-error" *ngIf="submitted || !rol?.rolnombre?.trim()">
                    El nombre de rol es requerido. (*)
                </small>
            </div>

            <div class="field">
                <label for="description">Descripci贸n</label>
                <textarea id="description"
                        name="description"
                        pInputTextarea
                        [ngModel]="rol.roldescripcion"
                        (ngModelChange)="onDescriptionChange($event)"
                        rows="3"
                        cols="20"
                        required
                        [ngClass]="{'p-invalid': rol?.roldescripcion?.trim() == null}">
                </textarea>
                <small class="p-error" *ngIf="submitted || !rol.roldescripcion?.trim()">
                    La descripci贸n es requerida. (*)
                </small>
            </div>
        </ng-template>

        <ng-template pTemplate="footer">
            <button pButton pRipple label="Cancelar" icon="pi pi-times" class="p-button-text"
                (click)="ocultarDialog()"></button>
            <button pButton pRipple label="Guardar" icon="pi pi-check" class="p-button-text"
                (click)="registroRol()"></button>
        </ng-template>
    </p-dialog>

    <p-dialog [(visible)]="eliminarRolDialog" header="Aviso: Confirmar" [modal]="true" [style]="{width:'400px'}">
        <div *ngIf="loading">
            <p-progressSpinner class="progress-spinner" styleClass="w-4rem h-4rem" strokeWidth="8"
                animationDuration=".5s"></p-progressSpinner>
        </div>
        <div class="flex align-items-center justify-content-center">
            <i class="pi pi-exclamation-triangle mr-3" style="font-size: 2rem"></i>
            <span *ngIf="rolRegistro">Estas seguro de eliminar el registro
                <b>{{rolRegistro.rolnombre}}</b>?</span>
        </div>
        <ng-template pTemplate="footer">
            <button pButton pRipple label="Cancelar" icon="pi pi-times" class="p-button-text"
                (click)="ocultarDialog()"></button>
            <button pButton pRipple label="Eliminar" icon="pi pi-check" class="p-button-text"
                (click)="confirmarEliminar()"></button>
        </ng-template>
    </p-dialog>
